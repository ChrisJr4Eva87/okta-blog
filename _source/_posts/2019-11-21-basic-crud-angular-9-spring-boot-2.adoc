---
layout: blog_post
title: "Build a Secure CRUD App with Angular 9.0 and Spring Boot 2.2"
author: mraible
description: "This tutorial demonstrates how to connect Angular and Spring Boot, with OIDC for auth, CSRF protection, and a CSP to prevent XSS."
tags: [angular, spring boot, typescript, kotlin, crud]
tweets:
- "Learn how to connect @angular and @springboot in 2019!"
- "Check out this tutorial on how to build secure apps with @angular and @springboot."
- "Build secure applications with @angular and @springboot in our 2019 howto guide."
image: blog/spring-boot-2-angular-8/secure-bootiful-angular.png
---

Intro, what's new in Angular 9.

What's new in Spring Boot 2.2.

Mention 10 Excellent Ways to Secure Spring Boot. TLS, mkcert, CSRF, dependabot, CSP, OIDC.

**Prerequisites:**

* Node 12
* Java 11
* Maven
* An Okta Developer Account

To install these prerequisites on a Mac, Linux, or Windows Subsystem for Linux (WSL), you can use [Homebrew](https://docs.brew.sh/Installation).

[source,shell]
----
brew install node
brew tap AdoptOpenJDK/openjdk
brew cask install adoptopenjdk11
brew install maven
----

You can also use [SDKMAN!](https://sdkman.io) to install Java 11 and Maven.

== Create an Angular 9 App

[source,shell]
----
npm install -g @angular/cli@9.0.0-rc.2
----

[source,shell]
----
ng new notes-client
----

== Create a Spring Boot 2.2 App

[source,shell]
----
http https://start.spring.io/starter.zip javaVersion==11 language==kotlin \
 type==gradle-project dependencies==h2,data-jpa,data-rest,lombok,okta,web -d
----

// todo: add package
// include screenshot of same thing with start.spring.io

=== Secure Spring Boot with Spring Security, OAuth 2.0, and OIDC

[source,shell]
----
mvn com.okta:okta-maven-plugin:setup
----

That's it! This will create an Okta developer account for you, as well as an OIDC app configured for Spring Security. Not only that, but it will copy the app's settings to `src/main/resources/application.properties`. Pretty slick, eh?!

TIP: You should never store secrets in source control. To prevent you from checking secrets in, use git-secrets. In this example, move your client secret from `application.properties` to `okta.env` and ignore `*.env` in `.gitignore`.

Start your app using `./gradlew bootRun` and open `http://localhost:8080` in a browser. You'll be redirected to Okta to login.

image::{% asset_path 'blog/spring-boot-2-angular9/okta-login.jpg' %}[alt=Okta Login,align=center]

Now that your backend is secure, you'll need to configure Angular to get an access token so it can talk to it. But first, configure your Spring Boot app to be an OAuth 2.0 resource server.

=== Spring Boot as an Auth 2.0 Resource Server

== Add Angular Authentication using OpenID Connect

[source,shell]
----
ng add @oktadev/schematics
----

== Add a Notes CRUD Feature

// spring data rest
//

== Lock Down Spring Boot with Recommended Security Practices

* CSRF vs. SameSite
* CSP
* HTTPS

== Use PostgreSQL for Production with Spring Boot

To pull down an image for the latest stable release of Postgres, simply run

[source,shell]
----
docker pull postgres
----

This will pull down the latest stable release Postgres image from the official Postgres docker hub repository.

If your want to persist data generated by the Postgres instance running inside a container beyond the container's lifecycle, we need to map a local mount point as a data volume to an appropriate path inside the container. Typically I create a volumes folder (we can give the folder any name we like) in my home directory and then create subfolders for each of the applications I need to create data volume mount points for.

[source,shell]
----
mkdir -p $HOME/docker/volumes/postgres
----

Starting the Postgres container is as simple as running the docker run command

[source,shell]
----
docker run --rm --name postgresql-docker -e POSTGRES_PASSWORD=docker -d -p 5432:5432 \
  -v $HOME/docker/volumes/postgres:/var/lib/postgresql/data  postgres
----

We have provided several options to the docker run command:

â€” rm: Automatically remove the container and it's associated file system upon exit. In general, if we are running lots of short term containers, it is good practice to to pass rm flag to the docker run command for automatic cleanup and avoid disk space issues. We can always use the v option (described below) to persist data beyond the lifecycle of a container
â€” name: An identifying name for the container. We can choose any name we want. Note that two existing (even if they are stopped) containers cannot have the same name. In order to re-use a name, you would either need pass the rm flag to the docker run command or explicitly remove the container by using the command docker rm [container name].
-e: Expose environment variable of name POSTGRES_PASSWORD with value docker to the container. This environment variable sets the superuser password for PostgreSQL. We can set POSTGRES_PASSWORD to anything we like. I just choose it to be docker for demonstration. There are additional environment variables you can set. These include POSTGRES_USER and POSTGRES_DB. POSTGRES_USER sets the superuser name. If not provided, the superuser name defaults to postgres. POSTGRES_DB sets the name of the default database to setup. If not provided, it defaults to the value of POSTGRES_USER.
-d: Launches the container in detached mode or in other words, in the background.
-p: Bind port 5432 on localhost to port 5432 within the container. This option enables applications running out side of the container to be able to connect to the Postgres server running inside the container.
-v: Mount $HOME/docker/volumes/postgres on the host machine to the container side volume path /var/lib/postgresql/data created inside the container. This ensures that postgres data persists even after the container is removed.

// https://hackernoon.com/dont-install-postgres-docker-pull-postgres-bee20e200198

// mention testcontainers for testing


// angular docker is ðŸ”¥ at 2900. Do another post and show
// 1) single artifact + docker + aws
// 2) static apps with netlify
// 3) cloud foundry and heroku for Spring Boot
// https://medium.com/@ryanyuliu/deploy-your-spring-boot-project-properly-for-free-66ae38012698
